name: Docker
on:
  push:
    tags:
      - 'v*.*.*'
jobs:
  build:
    name: Build Docker
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v1
      - name: Login to GitHub Docker Registry
        run: echo ${{ secrets.GITHUB_TOKEN }} | docker login docker.pkg.github.com --username ${{ secrets.GITHUB_DOCKER_USERNAME }} --password-stdin
      - name: SBT image build
        run: sbt docker:publishLocal
      - name: Docker tag
        run: docker tag master:latest docker.pkg.github.com/jaitl/cloud-crawler/master:${GITHUB_REF:10}
      - name: Docker push
        run: docker push docker.pkg.github.com/jaitl/cloud-crawler/master:${GITHUB_REF:10}
